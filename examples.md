# Ejemplos de Uso de la API v2.0

## üöÄ Inicio R√°pido

### 1. Iniciar la API

**Linux/Mac:**
```bash
./start_api.sh
```

**Windows:**
```cmd
start_api.bat
```

**Manual:**
```bash
python main.py
```

### 2. Verificar que la API est√© funcionando

```bash
curl http://localhost:8000/health
```

**Respuesta esperada:**
```json
{
  "status": "healthy",
  "models_loaded": true,
  "gpu_available": false,
  "available_methods": ["transformers", "textblob", "vader"],
  "default_method": "transformers"
}
```

### 3. Ver m√©todos disponibles

```bash
curl http://localhost:8000/methods
```

**Respuesta esperada:**
```json
{
  "available_methods": {
    "transformers": {
      "description": "Modelo BERT multiling√ºe avanzado (Opci√≥n 2 del proyecto)",
      "advantages": ["Alta precisi√≥n", "Multiling√ºe", "Contexto avanzado"],
      "disadvantages": ["M√°s lento", "Requiere m√°s recursos"]
    },
    "textblob": {
      "description": "An√°lisis r√°pido y eficiente con TextBlob",
      "advantages": ["R√°pido", "Ligero", "F√°cil de usar"],
      "disadvantages": ["Menos preciso", "Optimizado para ingl√©s"]
    },
    "vader": {
      "description": "An√°lisis basado en reglas l√©xicas (VADER)",
      "advantages": ["Muy r√°pido", "No requiere modelos", "Bueno para redes sociales"],
      "disadvantages": ["Basado en reglas", "Menos contexto"]
    }
  },
  "default_method": "transformers",
  "recommendations": {
    "transformers": "Para an√°lisis de alta precisi√≥n y multiling√ºe",
    "textblob": "Para an√°lisis r√°pido y eficiente",
    "vader": "Para an√°lisis en tiempo real y redes sociales"
  }
}
```

## üìù Ejemplos de Validaci√≥n con Diferentes M√©todos

### Ejemplo 1: Usando Transformers (M√©todo por defecto - Opci√≥n 2 del proyecto)

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "¬°Me encanta este proyecto! Es muy interesante y √∫til para la comunidad.",
       "language": "es",
       "sentiment_method": "transformers"
     }'
```

**Respuesta esperada:**
```json
{
  "original_text": "¬°Me encanta este proyecto! Es muy interesante y √∫til para la comunidad.",
  "is_offensive": false,
  "has_profanity": false,
  "emotion_score": 0.9,
  "emotion_label": "Muy Positivo",
  "profanity_count": 0,
  "suggestions": ["Tu texto est√° bien escrito y es apropiado para redes sociales"],
  "corrected_text": "¬°Me encanta este proyecto! Es muy interesante y √∫til para la comunidad.",
  "confidence": 0.95,
  "sentiment_method": "transformers",
  "method_info": {
    "description": "Modelo BERT multiling√ºe avanzado (Opci√≥n 2 del proyecto)",
    "advantages": ["Alta precisi√≥n", "Multiling√ºe", "Contexto avanzado"],
    "disadvantages": ["M√°s lento", "Requiere m√°s recursos"]
  },
  "processing_time": 1.234
}
```

### Ejemplo 2: Usando TextBlob (An√°lisis r√°pido)

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Este producto es terrible, no funciona nada bien.",
       "language": "es",
       "sentiment_method": "textblob"
     }'
```

**Respuesta esperada:**
```json
{
  "original_text": "Este producto es terrible, no funciona nada bien.",
  "is_offensive": true,
  "has_profanity": false,
  "emotion_score": -0.8,
  "emotion_label": "Muy Negativo",
  "profanity_count": 0,
  "suggestions": [
    "Considera usar palabras m√°s positivas y constructivas",
    "Evita t√©rminos que puedan generar emociones negativas",
    "Enf√≥cate en soluciones en lugar de problemas"
  ],
  "corrected_text": "Este producto es terrible, no funciona nada bien.",
  "confidence": 0.8,
  "sentiment_method": "textblob",
  "method_info": {
    "description": "An√°lisis r√°pido y eficiente con TextBlob",
    "advantages": ["R√°pido", "Ligero", "F√°cil de usar"],
    "disadvantages": ["Menos preciso", "Optimizado para ingl√©s"]
  },
  "processing_time": 0.045
}
```

### Ejemplo 3: Usando VADER (An√°lisis en tiempo real)

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Estoy muy decepcionado con los resultados del proyecto",
       "language": "es",
       "sentiment_method": "vader"
     }'
```

**Respuesta esperada:**
```json
{
  "original_text": "Estoy muy decepcionado con los resultados del proyecto",
  "is_offensive": true,
  "has_profanity": false,
  "emotion_score": -0.6,
  "emotion_label": "Negativo",
  "profanity_count": 0,
  "suggestions": [
    "Considera usar palabras m√°s positivas y constructivas",
    "Evita t√©rminos que puedan generar emociones negativas",
    "Enf√≥cate en soluciones en lugar de problemas"
  ],
  "corrected_text": "Estoy muy decepcionado con los resultados del proyecto",
  "confidence": 0.6,
  "sentiment_method": "vader",
  "method_info": {
    "description": "An√°lisis basado en reglas l√©xicas (VADER)",
    "advantages": ["Muy r√°pido", "No requiere modelos", "Bueno para redes sociales"],
    "disadvantages": ["Basado en reglas", "Menos contexto"]
  },
  "processing_time": 0.012
}
```

### Ejemplo 4: Texto con Groser√≠as (Cualquier m√©todo)

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Este c√≥digo es una mierda, el desarrollador es un gilipollas",
       "language": "es",
       "sentiment_method": "transformers"
     }'
```

**Respuesta esperada:**
```json
{
  "original_text": "Este c√≥digo es una mierda, el desarrollador es un gilipollas",
  "is_offensive": true,
  "has_profanity": true,
  "emotion_score": 0.2,
  "emotion_label": "Muy Negativo",
  "profanity_count": 2,
  "suggestions": [
    "Reemplaza las groser√≠as con palabras m√°s apropiadas",
    "Usa un lenguaje m√°s profesional y respetuoso",
    "Considera el impacto de tus palabras en diferentes audiencias"
  ],
  "corrected_text": "Este c√≥digo es un problema, el desarrollador es una persona",
  "confidence": 0.6,
  "sentiment_method": "transformers",
  "method_info": {...},
  "processing_time": 1.156
}
```

## üî¨ Comparaci√≥n de M√©todos

### Comparar todos los m√©todos con el mismo texto

```bash
# Texto positivo
text="¬°Este proyecto es incre√≠ble! Me encanta mucho."

echo "=== TRANSFORMERS ==="
curl -s -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d "{\"text\": \"$text\", \"language\": \"es\", \"sentiment_method\": \"transformers\"}" | jq '.emotion_score, .emotion_label, .processing_time'

echo "=== TEXTBLOB ==="
curl -s -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d "{\"text\": \"$text\", \"language\": \"es\", \"sentiment_method\": \"textblob\"}" | jq '.emotion_score, .emotion_label, .processing_time'

echo "=== VADER ==="
curl -s -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d "{\"text\": \"$text\", \"language\": \"es\", \"sentiment_method\": \"vader\"}" | jq '.emotion_score, .emotion_label, .processing_time'
```

## üìä Validaci√≥n en Lote

### Procesar m√∫ltiples textos

```bash
curl -X POST "http://localhost:8000/validate/batch" \
     -H "Content-Type: application/json" \
     -G -d "method=transformers" \
     -d '[
       "Excelente trabajo equipo!",
       "Me siento frustrado con los resultados",
       "Este es un proyecto incre√≠ble",
       "No puedo creer lo mal que est√° esto"
     ]'
```

**Respuesta esperada:**
```json
{
  "method": "transformers",
  "total_texts": 4,
  "valid_texts": 4,
  "results": [
    {
      "text": "Excelente trabajo equipo!",
      "is_offensive": false,
      "emotion_score": 0.9,
      "emotion_label": "Muy Positivo",
      "profanity_count": 0,
      "valid": true
    },
    {
      "text": "Me siento frustrado con los resultados",
      "is_offensive": true,
      "emotion_score": 0.3,
      "emotion_label": "Negativo",
      "profanity_count": 0,
      "valid": true
    }
  ]
}
```

## üîß Uso con Python

### Cliente Python con Selecci√≥n de M√©todo

```python
import requests
import json

def validate_text(text, language="es", method="transformers"):
    """Valida un texto usando la API con m√©todo espec√≠fico"""
    url = "http://localhost:8000/validate"
    payload = {
        "text": text,
        "language": language,
        "sentiment_method": method
    }
    
    try:
        response = requests.post(url, json=payload)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"Error en la API: {e}")
        return None

def compare_methods(text):
    """Compara todos los m√©todos de an√°lisis para un texto"""
    methods = ["transformers", "textblob", "vader"]
    results = {}
    
    for method in methods:
        result = validate_text(text, method=method)
        if result:
            results[method] = {
                "score": result['emotion_score'],
                "label": result['emotion_label'],
                "confidence": result['confidence'],
                "processing_time": result['processing_time']
            }
    
    return results

# Ejemplos de uso
texts = [
    "¬°Excelente trabajo equipo!",
    "Este producto es una basura",
    "Necesito ayuda con mi proyecto"
]

print("=== An√°lisis con Transformers (Opci√≥n 2 del proyecto) ===")
for text in texts:
    result = validate_text(text, method="transformers")
    if result:
        print(f"Texto: '{text[:50]}...'")
        print(f"  Score: {result['emotion_score']:.3f} ({result['emotion_label']})")
        print(f"  Tiempo: {result['processing_time']:.3f}s")

print("\n=== Comparaci√≥n de M√©todos ===")
comparison = compare_methods("Este proyecto es incre√≠ble!")
for method, data in comparison.items():
    print(f"{method.upper()}: Score={data['score']:.3f}, Time={data['processing_time']:.3f}s")
```

## üåê Uso con JavaScript/Fetch

### Cliente JavaScript con M√∫ltiples M√©todos

```javascript
async function validateText(text, language = 'es', method = 'transformers') {
    const url = 'http://localhost:8000/validate';
    const payload = {
        text: text,
        language: language,
        sentiment_method: method
    };
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('Error en la API:', error);
        return null;
    }
}

async function compareAllMethods(text) {
    const methods = ['transformers', 'textblob', 'vader'];
    const results = {};
    
    for (const method of methods) {
        const result = await validateText(text, 'es', method);
        if (result) {
            results[method] = {
                score: result.emotion_score,
                label: result.emotion_label,
                confidence: result.confidence,
                processingTime: result.processing_time
            };
        }
    }
    
    return results;
}

// Ejemplo de uso
const text = "Este c√≥digo es incre√≠ble, me encanta!";

// An√°lisis con m√©todo espec√≠fico
validateText(text, 'es', 'textblob').then(result => {
    if (result) {
        console.log('Resultado TextBlob:', result);
        console.log('Score:', result.emotion_score);
        console.log('Tiempo:', result.processing_time);
    }
});

// Comparar todos los m√©todos
compareAllMethods(text).then(results => {
    console.log('Comparaci√≥n de m√©todos:', results);
    
    // Encontrar el m√°s r√°pido
    const fastest = Object.entries(results).reduce((a, b) => 
        a[1].processingTime < b[1].processingTime ? a : b
    );
    console.log('M√©todo m√°s r√°pido:', fastest[0]);
});
```

## üìà An√°lisis de Rendimiento

### Script de Benchmark

```bash
#!/bin/bash

echo "üöÄ Benchmark de M√©todos de An√°lisis de Sentimientos"
echo "=================================================="

text="Este es un texto de prueba para medir el rendimiento de diferentes m√©todos de an√°lisis de sentimientos."

methods=("transformers" "textblob" "vader")
iterations=10

for method in "${methods[@]}"; do
    echo -e "\nüîç Probando m√©todo: $method"
    times=()
    
    for i in $(seq 1 $iterations); do
        start_time=$(date +%s.%N)
        
        response=$(curl -s -X POST "http://localhost:8000/validate" \
            -H "Content-Type: application/json" \
            -d "{\"text\": \"$text\", \"language\": \"es\", \"sentiment_method\": \"$method\"}")
        
        end_time=$(date +%s.%N)
        
        # Calcular tiempo
        elapsed=$(echo "$end_time - $start_time" | bc)
        times+=($elapsed)
        
        echo "  Ejecuci√≥n $i: ${elapsed}s"
    done
    
    # Calcular promedio
    total=0
    for t in "${times[@]}"; do
        total=$(echo "$total + $t" | bc)
    done
    avg=$(echo "scale=3; $total / ${#times[@]}" | bc)
    
    echo "  ‚è±Ô∏è  Tiempo promedio: ${avg}s"
done

echo -e "\nüèÅ Benchmark completado!"
```

## üéØ Casos de Uso por M√©todo

### 1. Transformers (BERT) - Opci√≥n 2 del proyecto
- **Cu√°ndo usar**: An√°lisis de alta precisi√≥n, textos en espa√±ol, contexto importante
- **Ejemplo**: Revisar posts importantes antes de publicar en redes sociales profesionales

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Nuestro nuevo producto revoluciona el mercado con tecnolog√≠a de vanguardia",
       "language": "es",
       "sentiment_method": "transformers"
     }'
```

### 2. TextBlob - An√°lisis r√°pido
- **Cu√°ndo usar**: An√°lisis en tiempo real, m√∫ltiples textos, recursos limitados
- **Ejemplo**: Moderaci√≥n de comentarios en tiempo real

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Great product, I love it!",
       "language": "en",
       "sentiment_method": "textblob"
     }'
```

### 3. VADER - Tiempo real
- **Cu√°ndo usar**: An√°lisis instant√°neo, redes sociales, textos cortos
- **Ejemplo**: Validaci√≥n de tweets antes de publicar

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "¬°Incre√≠ble d√≠a! #feliz #contento",
       "language": "es",
       "sentiment_method": "vader"
     }'
```

## üîç Monitoreo y Debugging

### Verificar Estado de la API

```bash
# Health check
curl http://localhost:8000/health

# Informaci√≥n general
curl http://localhost:8000/

# M√©todos disponibles
curl http://localhost:8000/methods

# Comparaci√≥n de m√©todos
curl http://localhost:8000/compare

# Logs del servidor (en la terminal donde ejecutaste main.py)
```

### M√©tricas de Rendimiento

```bash
# Medir tiempo de respuesta por m√©todo
time curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{"text": "Texto de prueba", "language": "es", "sentiment_method": "transformers"}'

time curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{"text": "Texto de prueba", "language": "es", "sentiment_method": "textblob"}'

time curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{"text": "Texto de prueba", "language": "es", "sentiment_method": "vader"}'
```

## üö® Casos de Error

### M√©todo no v√°lido

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "Texto de prueba",
       "language": "es",
       "sentiment_method": "metodo_invalido"
     }'
```

**Respuesta esperada:**
```json
{
  "detail": "M√©todo 'metodo_invalido' no v√°lido. M√©todos disponibles: ['transformers', 'textblob', 'vader']"
}
```

### Texto vac√≠o

```bash
curl -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{"text": "", "language": "es"}'
```

**Respuesta esperada:**
```json
{
  "detail": "El texto no puede estar vac√≠o"
}
```

## üéâ Resumen de Nuevas Funcionalidades

### ‚ú® **API v2.0 - Caracter√≠sticas Principales:**

1. **M√∫ltiples M√©todos de An√°lisis**:
   - **Transformers (BERT)**: Opci√≥n 2 del proyecto existente - Alta precisi√≥n
   - **TextBlob**: An√°lisis r√°pido y eficiente
   - **VADER**: An√°lisis en tiempo real para redes sociales

2. **Nuevos Endpoints**:
   - `/methods` - Informaci√≥n detallada de m√©todos
   - `/compare` - Comparaci√≥n de m√©todos
   - `/validate/batch` - Validaci√≥n en lote

3. **M√©tricas Mejoradas**:
   - Tiempo de procesamiento por m√©todo
   - Informaci√≥n del m√©todo utilizado
   - Comparaci√≥n de rendimiento

4. **Flexibilidad**:
   - Selecci√≥n de m√©todo por solicitud
   - An√°lisis adaptativo seg√∫n necesidades
   - Compatibilidad con el proyecto existente

---

**üí° Tip**: Usa `jq` para formatear las respuestas JSON de manera m√°s legible:

```bash
curl -s -X POST "http://localhost:8000/validate" \
     -H "Content-Type: application/json" \
     -d '{"text": "Texto de prueba", "language": "es", "sentiment_method": "textblob"}' | jq '.'
``` 